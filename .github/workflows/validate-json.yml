name: Validate JSON & Merge

on:
  pull_request:
    paths:
      - 'genres/*.json'

jobs:
  validate-and-merge:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v2

      - name: ğŸ§° Install jq
        run: |
          sudo apt-get update
          sudo apt-get install jq -y

      - name: ğŸ§ª Validate all JSON files in genres/
        run: |
          echo "ğŸ” VÃ©rification des fichiers JSON dans le dossier genres/"
          shopt -s nullglob
          files=(genres/*.json)
          if [ ${#files[@]} -eq 0 ]; then
            echo "âš ï¸ Aucun fichier JSON trouvÃ© dans genres/"
            exit 0
          fi

          for file in "${files[@]}"; do
            echo "âœ… VÃ©rification : $file"
            jq empty "$file" || {
              echo "âŒ JSON invalide : $file"
              exit 1
            }
          done
          echo "âœ… Tous les fichiers JSON sont valides !"

      - name: ğŸ Run Python merge script
        run: |
          echo "ğŸ“¦ Fusion des genres dans catalogue.json"
          python3 scripts/merge.py
